---
# tasks file for edjruntime
       - name: Install docker
         package:
          name: docker.io
          state: latest
       - name: update
         package:
          upgrade: dist
          force_apt_get: yes
       - name: Check for Python
         raw: test -e /usr/bin/python
         changed_when: false
         failed_when: false
         register: check_python
       - name: python
         package:
          name: python
          state: latest
       - name: common
         package:
          name: software-properties-common
          state: latest
       - name: python lib
         package:
           name: python3-pip
           state: latest
       - name: docker-py
         pip:
          name: docker-py
       - name: github login
         shell: cat TOKEN| docker login https://docker.pkg.github.com -u sriedjx --password-stdin
       - name: edjcli binary
         shell: wget "https://docs.google.com/uc?export=download&id=13pWZgKU9hbR1nhKv-laHKetfesCKTIUL" -O edjx.zip 
       - name: install unzip
         package:
           name: unzip
           state: latest
       - name: Extract edjx.zip to /usr/local/bin
         unarchive:
          src: edjx.zip
          dest: ./
       - name: copy edjx binary to /usr/local/bin
         copy:
           src: ./conf/edjx
           dest: /usr/local/bin
           mode: 0744 
       - name: init
         shell: edjx config init
       - name: edjx login
         shell:  edjx login -u suman+2@edjx.io -p Hello@123
       - name: node register
         shell: |
          set timeout 300
          edjx node register
          expect "Save node private key to:"
          send "runtime/certificates/private.pem\n"
          expect "Save node public key to:"
          send "runtime/certificates/public.pem\n"
          exit 0

